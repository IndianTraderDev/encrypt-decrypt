<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Secure Encrypt/Decrypt</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0d6efd">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
  <!-- Add futuristic Google Fonts and custom CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #0f2027 0%, #2c5364 100%);
      color: #e0eafc;
      font-family: 'Orbitron', 'Roboto Mono', monospace;
      min-height: 100vh;
    }
    .container {
      max-width: 540px;
      background: rgba(20, 30, 50, 0.85);
      border-radius: 18px;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      padding: 2.5rem 2rem;
      margin-top: 3rem;
      border: 1px solid rgba(255,255,255,0.08);
    }
    h2 {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      letter-spacing: 2px;
      text-align: center;
      margin-bottom: 2rem;
      color: #00fff7;
      text-shadow: 0 0 8px #00fff7, 0 0 2px #fff;
    }
    label {
      font-weight: 500;
      color: #aeefff;
      letter-spacing: 1px;
    }
    .form-control, textarea {
      background: rgba(44, 83, 100, 0.7);
      border: 1px solid #00fff7;
      color: #e0eafc;
      font-family: 'Roboto Mono', monospace;
      font-size: 1rem;
      border-radius: 8px;
      transition: box-shadow 0.2s;
    }
    .form-control:focus, textarea:focus {
      box-shadow: 0 0 0 2px #00fff7;
      border-color: #00fff7;
      background: rgba(44, 83, 100, 0.9);
      color: #fff;
    }
    .form-check-input {
      accent-color: #00fff7;
      box-shadow: 0 0 4px #00fff7;
    }
    .btn-primary, .btn-success {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      letter-spacing: 1px;
      border-radius: 8px;
      box-shadow: 0 2px 8px #00fff744;
      border: none;
      transition: background 0.2s, box-shadow 0.2s;
    }
    .btn-primary {
      background: linear-gradient(90deg, #00fff7 0%, #007cf0 100%);
      color: #1a1a2e;
    }
    .btn-primary:hover {
      background: linear-gradient(90deg, #007cf0 0%, #00fff7 100%);
      color: #fff;
      box-shadow: 0 4px 16px #00fff7aa;
    }
    .btn-success {
      background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);
      color: #1a1a2e;
    }
    .btn-success:hover {
      background: linear-gradient(90deg, #38f9d7 0%, #43e97b 100%);
      color: #fff;
      box-shadow: 0 4px 16px #43e97baa;
    }
    #result {
      background: rgba(44, 83, 100, 0.7);
      border: 1px solid #00fff7;
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
      min-height: 60px;
      color: #fff;
      font-family: 'Roboto Mono', monospace;
      font-size: 1rem;
      word-break: break-word;
      white-space: pre-wrap;
      box-shadow: 0 2px 8px #00fff744;
    }
    .form-check-label {
      color: #e0eafc;
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      margin-left: 4px;
    }
    @media (max-width: 600px) {
      .container {
        padding: 1rem 0.5rem;
      }
      h2 {
        font-size: 1.5rem;
      }
    }
  </style>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(function(registration) {
        console.log('ServiceWorker registration successful:', registration.scope);
      }, function(error) {
        console.error('ServiceWorker registration failed:', error);
      });
    }
  </script>
</head>
<body>
  <div class="container">
    <h2>Secure Encrypt/Decrypt</h2>
    <div class="mb-3">
      <label for="password">Password</label>
      <input class="form-control" id="password" type="password" autocomplete="off" placeholder="Enter your password">
    </div>
    <div class="mb-3">
      <label for="text">Text</label>
      <textarea class="form-control" id="text" rows="8" placeholder="Enter text to encrypt or decrypt"></textarea>
    </div>
    <div class="d-flex justify-content-between mb-3">
      <div class="form-check">
        <input class="form-check-input" type="radio" name="option" id="optionEncrypt">
        <label class="form-check-label" for="optionEncrypt">Encrypt</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="option" id="optionDecrypt">
        <label class="form-check-label" for="optionDecrypt">Decrypt</label>
      </div>
    </div>
    <div class="d-flex gap-2 mb-3">
      <button id="go" class="btn btn-primary flex-grow-1">Process</button>
      <button onclick="copy()" class="btn btn-success flex-grow-1">Copy</button>
    </div>
    <h5 class="mt-3" style="color:#00fff7;text-shadow:0 0 6px #00fff7;">Result</h5>
    <div id="result"></div>
  </div>

  <script>
    const textEl = document.getElementById("text");
    const passEl = document.getElementById("password");
    const resultEl = document.getElementById("result");

    async function getKey(password, salt) {
      const encoder = new TextEncoder();
      const keyMaterial = await crypto.subtle.importKey(
        "raw", encoder.encode(password), { name: "PBKDF2" }, false, ["deriveKey"]
      );
      return crypto.subtle.deriveKey(
        {
          name: "PBKDF2",
          salt: salt,
          iterations: 250000,
          hash: "SHA-256"
        },
        keyMaterial,
        { name: "AES-GCM", length: 256 },
        false,
        ["encrypt", "decrypt"]
      );
    }

    async function encrypt(text, password) {
      const encoder = new TextEncoder();
      const salt = crypto.getRandomValues(new Uint8Array(16));
      const iv = crypto.getRandomValues(new Uint8Array(12));
      const key = await getKey(password, salt);
      const ciphertext = await crypto.subtle.encrypt({ name: "AES-GCM", iv: iv }, key, encoder.encode(text));
      const combined = new Uint8Array(salt.byteLength + iv.byteLength + ciphertext.byteLength);
      combined.set(salt);
      combined.set(iv, salt.byteLength);
      combined.set(new Uint8Array(ciphertext), salt.byteLength + iv.byteLength);
      return btoa(String.fromCharCode(...combined));
    }

    async function decrypt(encoded, password) {
      try {
        const data = Uint8Array.from(atob(encoded), c => c.charCodeAt(0));
        const salt = data.slice(0, 16);
        const iv = data.slice(16, 28);
        const ciphertext = data.slice(28);
        const key = await getKey(password, salt);
        const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv: iv }, key, ciphertext);
        return new TextDecoder().decode(decrypted);
      } catch (e) {
        return "❌ Decryption failed. Incorrect password or corrupted data.";
      }
    }

    document.getElementById("go").onclick = async () => {
      const password = passEl.value;
      const text = textEl.value;
      const option = document.querySelector('input[name="option"]:checked');

      if (!password || !option) {
        resultEl.innerText = "⚠️ Please provide both password and action.";
        return;
      }

      if (option.id === "optionEncrypt") {
        const encrypted = await encrypt(text, password);
        resultEl.innerText = encrypted;
      } else {
        const decrypted = await decrypt(text, password);
        resultEl.innerText = decrypted;
      }
    };

    function copy() {
      navigator.clipboard.writeText(resultEl.innerText).then(() => {
        alert("Copied!");
      }, () => {
        alert("Failed to copy.");
      });
    }
  </script>
</body>
</html>
